<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Math</title>

    <!-- Material -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>

    <style>
        .container {
            text-align: center;
        }

        .error {
            color: #e53935;
        }

        .success {
            color: #64dd17;
        }

        .result {
            border: 1px solid #ccc;
            padding: 0.01em 16px;
            border-radius: 16px;
            width: 48%;
            float: left;
            margin-right: 2%;
            margin-top: 10px;
            text-align: center;
            font-size: larger;
            text-transform: none;
        }

    </style>
</head>
<body>

<div id="app">
    <nav style="background: #006064">
        <div class="nav-wrapper" v-on:click="changeApp()">
            <a href="#!" class="brand-logo"><i class="material-icons">{{currentApp.icon}}</i>Math</a>
        </div>
    </nav>
    <div class="container">
        <div class="row">
            <h3>{{exercise}}</h3>
        </div>
        <div class="row">
            <a class="waves-effect waves-light btn-large result"
               v-for="(result, index) in results"
               v-on:click="check(index)">{{ result }}</a>

        </div>
        <div class="row" dir="rtl">
            <h2 v-on:click="next()"
                v-bind:class="{ 'error': message.error, 'success': message.success }">{{ message.value }}</h2>
        </div>

    </div>

</div>


<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/he/1.2.0/he.min.js"></script>

<!-- Material -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>

<script>
    function randomIntFromInterval(min, max) {
        return Math.floor(Math.random() * (max - min + 1) + min);
    }

    function add() {
        let a = randomIntFromInterval(1, 10);
        let b = randomIntFromInterval(0, 6);
        let result = a + b;
        let results = [result,];
        while (results.length !== 4) {
            let option = randomIntFromInterval(1, 16);
            if (!results.includes(option)) {
                results.push(option);
            }

        }
        return [result, results, `${a} + ${b} =`];
    }

    function sub() {
        let aa = randomIntFromInterval(1, 10);
        let bb = randomIntFromInterval(0, 6);
        let a = Math.max(aa, bb);
        let b = Math.min(aa, bb);
        let result = a - b;
        let results = [result,];
        while (results.length !== 4) {
            let option = randomIntFromInterval(1, 16);
            if (!results.includes(option)) {
                results.push(option);
            }

        }
        return [result, results, `${a} - ${b} =`];
    }

    function getNItmes(number) {
        return he.decode(Array(number + 1).join("&#128540; "))
    }

    function count() {
        let result = randomIntFromInterval(1, 5);
        let nums = [result,];
        while (nums.length !== 4) {
            let option = randomIntFromInterval(1, 5);
            if (!nums.includes(option)) {
                nums.push(option);
            }
        }

        let results = [];
        for (let i = 0; i < nums.length; i++) {
            results.push(getNItmes(nums[i]));
        }
        return [getNItmes(result), results, result];
    }

    apps = [{icon: 'add_circle_outline', func: add},
        {icon: 'remove_circle_outline', func: sub},
        {icon: 'format_list_numbered', func: count}];

    let app = new Vue({
        el: '#app',
        data: {
            result: 0,
            exercise: '',
            message: '',
            ended: false,
            currentAppNumber: 2
        },
        methods: {
            create: function (code) {
                this.message = {};
                this.ended = false;
                let a = this.currentApp.func();
                this.results = this.shuffle(a[1]);
                this.exercise = a[2];
                this.result = a[0];

            }, shuffle: function (a) {
                for (let i = a.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [a[i], a[j]] = [a[j], a[i]];
                }
                return a;
            }, check: function(index) {
                if (this.results[index] === this.result) {
                    this.ended = true;
                    this.message = {value: this.getSuccessMsg(), success: true}
                } else {
                    this.message = {value: 'נסה שוב :(', error: true}
                }
            }, next: function() {
                if (this.ended) {
                    this.create()
                }
            }, getSuccessMsg: function(){
                return he.decode("הצלחת &#128525;");
            }, changeApp: function () {
                this.currentAppNumber = (this.currentAppNumber + 1) % apps.length;
                this.create();
            }
        }, created: function () {
            this.create();
        }, computed: {
            currentApp: function () {
                return apps[this.currentAppNumber];
            }
        }
    })
</script>
</body>
</html>